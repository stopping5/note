SOA

微服务

# 一、初期单体架构

## 1.0	初期单体

用户->Tomcat->数据库

## 2.0	解决流量问题

用户->nginx->tomcat/tomcat/tomcat(集群)->数据库 

## 3.0	解决业务复杂度问题

使用垂直拆分，将功能模块分开子系统对应单独数据库。

![image-20200530213015190](H:\TyporaImage\微服务\image-20200530213015190.png)

## 4.0 	服务化（SOA）关心重复的服务的复用性

将重复的功能抽离出来作为公共模块。核心是面向服务开发。

# 二、微服务

业务系统实施服务化改造后，原本共享的业务被拆分，形成可复用的服务，可以在最大程度上避免共享业务的重复建设、资源连接瓶颈等问题出现。那么那些被拆分出来的服务，是否也需要以业务功能为维度来进行拆分，使之能够独立进行部署，以降低业务藕合和提升容错性呢？微服务并不是一种新思想的方法。**它更像是一种思想的精炼，是一种服务化思想的最佳实践方向而已**，所以我认为微服务其实是在 SOA 思路下，随着各个企业对于**服务化治理**上不断的完善，以及对软件的交付链路以及基础设施逐步成熟之下的一种自然的产物。 微服务也是一种面向服务的架构模型，只是它更强调服务的粒度。也就是服务的职责更加单一更加精炼我们也可以把 **SOA 看成是微服务的超集**。 也就是多个**微服务可以组成一个 soa 服务**。

下图是微服务概念下的产品设计，将网站的功能拆分为用户服务、订单服务、商品服务模块进行开发，如果订单服务吞吐量大则通过集群的方式处理吞吐量。但是也会衍生一系列问题：

1、负载均衡

2、服务注册（服务的管理）

3、限流、熔断（服务的稳定性）

4、服务的链路注册

但是这些问题都可以通过Dubbo+SpringBoot做服务治理解决也是实现了微服务。

![image-20200530220105158](H:\TyporaImage\微服务\image-20200530220105158.png)



# 三、微服务和SOA的区别

1、面向服务 关注点是**重用**。微服务 关注点是**解耦**。

2、微服务强调**RESTFul**

3、微服务会更多的关注 Devops 的持续交付，因为服务粒度更细使得开发运维变得更加重要。所以微服务对于容器化技术的结合更加紧密

4、SOA 应该是微服务的超集（运维几万个微服务）-> 容器化

# 四、分布式和微服务的关系

分布式是一种硬件架构，跟像一种理论结构。SOA和微服务属于分布式的框架呢。

![image-20200530214824091](H:\TyporaImage\微服务\image-20200530214824091.png)

# 五、Spring Cloud生态

## 1、概念

spring cloud 提供了一些可以让开发者快速构建分布式应用的工具，这些服务可以很好的工作在任何分布式环境下。（工具箱）是一种标准大部分组件都是用来做整合。基于Sringboot构建。

例如：服务注册可以通过Consul/etcd/zookeeper处理。负载均衡可以通过Ribbon+fegin处理，配置重新config,熔断Hystrix。这些都是Spring Cloud提供的组件。

## 2、网关

在微服务实施之后，各个服务的拆分粒度很小，对于客户端来说，做一个操作可能会涉及到后端的多个服务组件的调用，那意味着它需要频繁的发起多次访问才能进行数据聚合实现用户的功能。如果我们在所有的微服务之前增加一个网关，对于客户端来说它需要做什么功能操作直接调用网关并且告诉网关所要做的事情即可，网关根据请求的功能对后端的多个服务的数据进行聚合聚合哦从而减少客户端的调用频次。并且，由于有了网关的聚合，我们还可以在网关层对请求进行统一鉴权和认证； 包括还可以实现限流、请求日志统一记录、 灰度发布等等。

![image-20200530221945632](H:\TyporaImage\微服务\image-20200530221945632.png)吧

## 3、服务通信和发现

## 4、负载

## 5、熔断、限流、降级

## 6、统一配置中心

例如订单服务有一千个结点如果没有使用统一配置中心的话，修改配置将导致要修改1000个配置中心。使用统一配置中心的话将可以避免这种情况。

![image-20200530234302626](H:\TyporaImage\微服务\image-20200530234302626.png)

# 六、SpringBoot简介

基于约定大于配置的概念。

# 七、Service Mesh

在第一代网络计算机系统时代，那个时候的程序员需要完成服务的网络通信，需要自己写代码来处理网络通信的细节，比如数据包的顺序、流量控制。导致网络处理逻辑和业务逻辑混合在一起，同时对于开发人员来说要求较高。为了解决这个问题，把网络层的处理逻辑进行抽象，实现了 TCP/IP 技术。对于用户而言，并不需要关心底层的网络通信环节。

到了微服务时代，我们也面临了类似的问题。业务人员在做微服务开发时需要处理一些列比较基础的事情，比如服务注册、服务发现、负载均衡、服务熔断和重试等。这些功能对于每一个业务程序员而言，都必须要了解和掌握，而实际上这些和业务功能并没有太大的关系，它理应是一个基础组件。

所以 有些公司就开始开发基础组件 典型的Netflix OSS 套 件（eureka/hystrix/feign/ribbon/zuul）。有了这些组件，开发人员就可以使用很少的代码来实现这些服务治理的功能。而恰恰因为这个原因，使得 Spring Cloud 的普及非常快，几乎成了微服务的代名词

![image-20200531001523313](H:\TyporaImage\微服务\image-20200531001523313.png)